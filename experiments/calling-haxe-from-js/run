#!/bin/bash

# I have no idea if this is the best way or not
# it's just what I figured out by reading some stuff and trying some stuff
#
# I think I got node.js from: http://nodejs.org/download/ but not sure.
# get browserify with: npm install -g browserify

TITLE:() {
  color="\033[34m"
  endcolor="\033[0m"
  text="-- $* --"
  printf -- "${color}${text}${endcolor}\n"
}

TITLE: SETTING UP THE ENVIRONMENT
cd "$(dirname "$0")"
root_dir="$(pwd -P)"
export NODE_PATH="$root_dir" # allows it to find the files its requiring

TITLE: COMPILING HAXE TO JS
haxe "HxHw.hx" -js "hx_hw.js" # no `-main` flag means it won't invoke our main


TITLE: RUNNING IN NODE
node "main.node.js" || exit $!


TITLE: COMPILING FOR BROWSER
# browserify "main.node.js" -o "main.browser.js" <-- use this if we didn't have to fix the dependency injection
browserify "main.node.js" |
  sed 's/typeof window != "undefined" ? window : exports/exports/' > "main.browser.js" ||
  exit $!


TITLE: RUNNING BROWSER CODE IN NODE
node "main.browser.js" || exit $!


TITLE: OPENING IN BROWSER # idk if non-mac's have an "open" command
open "page.html"
